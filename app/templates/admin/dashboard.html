{% extends "admin/base.html" %}

{% block title %}–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è - –ê–¥–º–∏–Ω–∫–∞{% endblock %}
{% block page_title %}–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è{% endblock %}

{% block content %}
<!-- Welcome Section -->
<div class="admin-card">
    <h2 style="margin-bottom: 1rem; color: var(--text-primary);">
        –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ user.full_name }}! üëã
    </h2>
    <p style="color: var(--text-secondary); margin-bottom: 1rem;">
        –ü–æ—Å–ª–µ–¥–Ω–∏–π –≤—Ö–æ–¥: 
        {% if user.last_login %}
            {{ user.last_login.strftime('%d.%m.%Y –≤ %H:%M') }}
        {% else %}
            –ü–µ—Ä–≤—ã–π –≤—Ö–æ–¥
        {% endif %}
    </p>
    <p style="color: var(--text-secondary);">
        –í–∞—à JWT –∫–ª—é—á –¥–ª—è –¥–æ—Å—Ç—É–ø–∞: <code style="background: var(--dark-bg-tertiary); 
        padding: 0.25rem 0.5rem; border-radius: 4px; font-family: monospace;">{{ jwt_secret }}</code>
    </p>
</div>

<!-- Statistics -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-cogs"></i>
        </div>
        <div class="stat-value">{{ stats.services_count }}</div>
        <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö —É—Å–ª—É–≥</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-briefcase"></i>
        </div>
        <div class="stat-value">{{ stats.portfolio_count }}</div>
        <div class="stat-label">–ü—Ä–æ–µ–∫—Ç–æ–≤ –≤ –ø–æ—Ä—Ç—Ñ–æ–ª–∏–æ</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-star"></i>
        </div>
        <div class="stat-value">{{ stats.featured_projects }}</div>
        <div class="stat-label">–ò–∑–±—Ä–∞–Ω–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤</div>
    </div>
    
    <div class="stat-card">
        <div class="stat-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        <div class="stat-value">{{ stats.completed_projects or 0 }}</div>
        <div class="stat-label">–ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤</div>
    </div>
</div>

<!-- Quick Actions -->
<div class="admin-card">
    <h3 style="margin-bottom: 1.5rem; color: var(--text-primary);">
        <i class="fas fa-bolt" style="color: var(--primary-color); margin-right: 0.5rem;"></i>
        –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
    </h3>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
        <a href="{{ url_for('admin_' + jwt_secret + '.service_new') }}" 
           class="btn btn-primary" style="text-align: center; padding: 1rem;">
            <i class="fas fa-plus"></i>
            –î–æ–±–∞–≤–∏—Ç—å —É—Å–ª—É–≥—É
        </a>
        
        <a href="{{ url_for('admin_' + jwt_secret + '.portfolio_new') }}" 
           class="btn btn-primary" style="text-align: center; padding: 1rem;">
            <i class="fas fa-plus"></i>
            –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç
        </a>
        
        <a href="{{ url_for('main.homepage') }}" target="_blank" 
           class="btn btn-secondary" style="text-align: center; padding: 1rem;">
            <i class="fas fa-external-link-alt"></i>
            –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–∞–π—Ç
        </a>
        
        <a href="{{ url_for('admin_' + jwt_secret + '.api_services') }}" target="_blank" 
           class="btn btn-secondary" style="text-align: center; padding: 1rem;">
            <i class="fas fa-code"></i>
            API —É—Å–ª—É–≥
        </a>
    </div>
</div>

<!-- Recent Activity -->
<div class="grid grid-2" style="gap: 2rem;">
    <!-- Services Preview -->
    <div class="admin-card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h3 style="margin: 0; color: var(--text-primary);">
                <i class="fas fa-cogs" style="color: var(--primary-color); margin-right: 0.5rem;"></i>
                –ü–æ—Å–ª–µ–¥–Ω–∏–µ —É—Å–ª—É–≥–∏
            </h3>
            <a href="{{ url_for('admin_' + jwt_secret + '.services') }}" class="btn btn-outline btn-sm">
                –í—Å–µ —É—Å–ª—É–≥–∏
            </a>
        </div>
        
        <div id="recent-services">
            <div style="text-align: center; color: var(--text-muted); padding: 2rem;">
                <i class="fas fa-spinner fa-spin"></i>
                –ó–∞–≥—Ä—É–∑–∫–∞...
            </div>
        </div>
    </div>
    
    <!-- Portfolio Preview -->
    <div class="admin-card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h3 style="margin: 0; color: var(--text-primary);">
                <i class="fas fa-briefcase" style="color: var(--primary-color); margin-right: 0.5rem;"></i>
                –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç—ã
            </h3>
            <a href="{{ url_for('admin_' + jwt_secret + '.portfolio') }}" class="btn btn-outline btn-sm">
                –í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã
            </a>
        </div>
        
        <div id="recent-portfolio">
            <div style="text-align: center; color: var(--text-muted); padding: 2rem;">
                <i class="fas fa-spinner fa-spin"></i>
                –ó–∞–≥—Ä—É–∑–∫–∞...
            </div>
        </div>
    </div>
</div>

<!-- System Info -->
<div class="admin-card">
    <h3 style="margin-bottom: 1.5rem; color: var(--text-primary);">
        <i class="fas fa-info-circle" style="color: var(--primary-color); margin-right: 0.5rem;"></i>
        –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    </h3>
    
    <div class="grid grid-3" style="gap: 1.5rem;">
        <div style="text-align: center;">
            <div style="font-size: 1.5rem; color: var(--success-color); margin-bottom: 0.5rem;">
                <i class="fas fa-check-circle"></i>
            </div>
            <div style="font-weight: 600; color: var(--text-primary);">–°–∏—Å—Ç–µ–º–∞</div>
            <div style="color: var(--text-secondary); font-size: 0.875rem;">–†–∞–±–æ—Ç–∞–µ—Ç –Ω–æ—Ä–º–∞–ª—å–Ω–æ</div>
        </div>
        
        <div style="text-align: center;">
            <div style="font-size: 1.5rem; color: var(--success-color); margin-bottom: 0.5rem;">
                <i class="fas fa-database"></i>
            </div>
            <div style="font-weight: 600; color: var(--text-primary);">–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö</div>
            <div style="color: var(--text-secondary); font-size: 0.875rem;">–ü–æ–¥–∫–ª—é—á–µ–Ω–∞</div>
        </div>
        
        <div style="text-align: center;">
            <div style="font-size: 1.5rem; color: var(--primary-color); margin-bottom: 0.5rem;">
                <i class="fas fa-shield-alt"></i>
            </div>
            <div style="font-weight: 600; color: var(--text-primary);">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</div>
            <div style="color: var(--text-secondary); font-size: 0.875rem;">JWT –∞–∫—Ç–∏–≤–µ–Ω</div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Load recent services
    loadRecentServices();
    
    // Load recent portfolio
    loadRecentPortfolio();
});

function loadRecentServices() {
    fetch('{{ url_for("admin_" + jwt_secret + ".api_services") }}')
        .then(response => response.json())
        .then(services => {
            const container = document.getElementById('recent-services');
            
            if (services.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; color: var(--text-muted); padding: 2rem;">
                        <i class="fas fa-plus-circle" style="font-size: 2rem; margin-bottom: 1rem;"></i><br>
                        –ù–µ—Ç —É—Å–ª—É–≥<br>
                        <a href="{{ url_for('admin_' + jwt_secret + '.service_new') }}" class="btn btn-primary btn-sm" style="margin-top: 1rem;">
                            –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—É—é
                        </a>
                    </div>
                `;
                return;
            }
            
            const recentServices = services.slice(0, 3);
            container.innerHTML = recentServices.map(service => `
                <div style="display: flex; align-items: center; padding: 0.75rem; 
                            border: 1px solid var(--border-color); border-radius: var(--radius-lg); 
                            margin-bottom: 0.5rem; background: var(--dark-bg-tertiary);">
                    <div style="width: 40px; height: 40px; background: ${service.color}; 
                                border-radius: 50%; display: flex; align-items: center; 
                                justify-content: center; margin-right: 1rem; color: white;">
                        <i class="${service.icon}"></i>
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; color: var(--text-primary);">${service.title}</div>
                        <div style="font-size: 0.875rem; color: var(--text-secondary);">
                            ${service.is_active ? 'üü¢ –ê–∫—Ç–∏–≤–Ω–∞' : 'üî¥ –ù–µ–∞–∫—Ç–∏–≤–Ω–∞'}
                        </div>
                    </div>
                </div>
            `).join('');
        })
        .catch(error => {
            console.error('Error loading services:', error);
            document.getElementById('recent-services').innerHTML = `
                <div style="text-align: center; color: var(--error-color); padding: 2rem;">
                    <i class="fas fa-exclamation-triangle"></i><br>
                    –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
                </div>
            `;
        });
}

function loadRecentPortfolio() {
    fetch('{{ url_for("admin_" + jwt_secret + ".api_portfolio") }}')
        .then(response => response.json())
        .then(projects => {
            const container = document.getElementById('recent-portfolio');
            
            if (projects.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; color: var(--text-muted); padding: 2rem;">
                        <i class="fas fa-plus-circle" style="font-size: 2rem; margin-bottom: 1rem;"></i><br>
                        –ù–µ—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤<br>
                        <a href="{{ url_for('admin_' + jwt_secret + '.portfolio_new') }}" class="btn btn-primary btn-sm" style="margin-top: 1rem;">
                            –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π
                        </a>
                    </div>
                `;
                return;
            }
            
            const recentProjects = projects.slice(0, 3);
            container.innerHTML = recentProjects.map(project => `
                <div style="display: flex; align-items: center; padding: 0.75rem; 
                            border: 1px solid var(--border-color); border-radius: var(--radius-lg); 
                            margin-bottom: 0.5rem; background: var(--dark-bg-tertiary);">
                    <div style="width: 40px; height: 40px; background: var(--gradient-primary); 
                                border-radius: var(--radius-lg); display: flex; align-items: center; 
                                justify-content: center; margin-right: 1rem; color: white; font-weight: bold;">
                        ${project.title.charAt(0)}
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; color: var(--text-primary);">${project.title}</div>
                        <div style="font-size: 0.875rem; color: var(--text-secondary);">
                            ${project.client} ‚Ä¢ ${project.category}
                            ${project.is_featured ? ' ‚≠ê' : ''}
                        </div>
                    </div>
                    <div style="text-align: right; color: var(--primary-color); font-weight: 600;">
                        ${project.price_formatted || '‚Äî'}
                    </div>
                </div>
            `).join('');
        })
        .catch(error => {
            console.error('Error loading portfolio:', error);
            document.getElementById('recent-portfolio').innerHTML = `
                <div style="text-align: center; color: var(--error-color); padding: 2rem;">
                    <i class="fas fa-exclamation-triangle"></i><br>
                    –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏
                </div>
            `;
        });
}
</script>
{% endblock %} 